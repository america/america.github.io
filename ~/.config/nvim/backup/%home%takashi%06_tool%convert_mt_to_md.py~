import os
import re

# 入力ファイルと出力ディレクトリ
input_file = 'mt_export.txt'
output_dir = './output'
os.makedirs(output_dir, exist_ok=True)

# ファイル名に使用できない文字を置換
def sanitize_filename(title):
    return re.sub(r'[\/:*?"<>|]', '_', title)

# MT形式を読み込み
with open(input_file, 'r', encoding='utf-8') as file:
    lines = file.readlines()

entry = []
in_entry = False

for line in lines:
    if line.startswith("-----"):
        # 記事終了
        if in_entry:
            title = None
            date = None
            categories = []
            content = []
            
            for e in entry:
                if e.startswith("TITLE:"):
                    title = e[len("TITLE:"):].strip()
                elif e.startswith("DATE:"):
                    date = e[len("DATE:"):].strip()
                elif e.startswith("CATEGORY:"):
                    categories.append(e[len("CATEGORY:"):].strip())
                else:
                    content.append(e)
            
            # Markdownファイル作成
            if title and date:
                sanitized_title = sanitize_filename(title)
                filename = f"{sanitized_title}.md"
                filepath = os.path.join(output_dir, filename)
                with open(filepath, 'w', encoding='utf-8') as f:
                    f.write("---\n")
                    f.write(f"title: \"{title}\"\n")
                    f.write(f"date: {date}\n")
                    f.write("categories:\n")
                    for category in categories:
                        f.write(f"  - {category}\n")
                    f.write("draft: true\n")
                    f.write("---\n\n")
                    f.write("".join(content))
            
            entry = []
        in_entry = not in_entry
    elif in_entry:
        entry.append(line)

