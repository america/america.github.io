<!doctype html><html lang=en dir=auto><head><link rel=stylesheet href=https://america.github.io/css/custom.min.33a100211c78b6f43369add32141384e52f5113cf74ee8e9ff803f1e37dbed32.css><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>AWSでSSH接続できない問題を解決した話 | 雑記</title>
<meta name=keywords content="AWS,SSH,トラブルシューティング"><meta name=description content="はじめに
先日、AWSで立てたEC2インスタンスにSSH接続できなくなる問題が発生しました。このトラブルの原因と解決方法を記録しておきます。同じ状況に陥った方の助けになれば幸いです。

問題の症状

EC2インスタンスにSSH接続を試みると、Connection timed out のエラーが表示される。
AWSコンソール上では、インスタンスは正常に動作中。
ブラウザからの接続は可能（インスタンス内のApacheは稼働中）。


原因と解決方法
調査の結果、以下の4つの原因が考えられました。
原因1: セキュリティグループのルール設定ミス
問題点
セキュリティグループでポート22（SSH）が許可されていなかった。
解決方法
AWSコンソールのセキュリティグループ設定に以下のルールを追加：

タイプ: SSH
プロトコル: TCP
ポート範囲: 22
ソース: 自分のグローバルIPアドレス（例: 203.0.113.0/32）


原因2: UFW（Uncomplicated Firewall）がポート22を閉じていた
問題点
EC2インスタンス内のUFW（ローカルファイアウォール）でポート22が閉じられていた。
解決方法
以下のコマンドを実行してポート22を許可し、設定を反映しました。

    
    
        sudo ufw allow 22
sudo ufw reload
    
    Copy

    


原因3: グローバルIPの変動
問題点
自分のグローバルIPアドレスが変更されたことで、セキュリティグループのルールが機能しなくなった。"><meta name=author content><link rel=canonical href=https://america.github.io/posts/aws_ssh_issue/><link crossorigin=anonymous href=/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css integrity="sha256-1vzSCk+4bvpN+sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as=style><link rel=icon href=https://america.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://america.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://america.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://america.github.io/apple-touch-icon.png><link rel=mask-icon href=https://america.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://america.github.io/posts/aws_ssh_issue/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://america.github.io/posts/aws_ssh_issue/"><meta property="og:site_name" content="雑記"><meta property="og:title" content="AWSでSSH接続できない問題を解決した話"><meta property="og:description" content="はじめに 先日、AWSで立てたEC2インスタンスにSSH接続できなくなる問題が発生しました。このトラブルの原因と解決方法を記録しておきます。同じ状況に陥った方の助けになれば幸いです。
問題の症状 EC2インスタンスにSSH接続を試みると、Connection timed out のエラーが表示される。 AWSコンソール上では、インスタンスは正常に動作中。 ブラウザからの接続は可能（インスタンス内のApacheは稼働中）。 原因と解決方法 調査の結果、以下の4つの原因が考えられました。
原因1: セキュリティグループのルール設定ミス 問題点
セキュリティグループでポート22（SSH）が許可されていなかった。
解決方法
AWSコンソールのセキュリティグループ設定に以下のルールを追加：
タイプ: SSH プロトコル: TCP ポート範囲: 22 ソース: 自分のグローバルIPアドレス（例: 203.0.113.0/32） 原因2: UFW（Uncomplicated Firewall）がポート22を閉じていた 問題点
EC2インスタンス内のUFW（ローカルファイアウォール）でポート22が閉じられていた。
解決方法
以下のコマンドを実行してポート22を許可し、設定を反映しました。
sudo ufw allow 22 sudo ufw reload Copy 原因3: グローバルIPの変動 問題点
自分のグローバルIPアドレスが変更されたことで、セキュリティグループのルールが機能しなくなった。"><meta property="og:locale" content="ja"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-20T00:00:00+00:00"><meta property="article:modified_time" content="2024-11-20T00:00:00+00:00"><meta property="article:tag" content="AWS"><meta property="article:tag" content="SSH"><meta property="article:tag" content="トラブルシューティング"><meta name=twitter:card content="summary"><meta name=twitter:title content="AWSでSSH接続できない問題を解決した話"><meta name=twitter:description content="はじめに
先日、AWSで立てたEC2インスタンスにSSH接続できなくなる問題が発生しました。このトラブルの原因と解決方法を記録しておきます。同じ状況に陥った方の助けになれば幸いです。

問題の症状

EC2インスタンスにSSH接続を試みると、Connection timed out のエラーが表示される。
AWSコンソール上では、インスタンスは正常に動作中。
ブラウザからの接続は可能（インスタンス内のApacheは稼働中）。


原因と解決方法
調査の結果、以下の4つの原因が考えられました。
原因1: セキュリティグループのルール設定ミス
問題点
セキュリティグループでポート22（SSH）が許可されていなかった。
解決方法
AWSコンソールのセキュリティグループ設定に以下のルールを追加：

タイプ: SSH
プロトコル: TCP
ポート範囲: 22
ソース: 自分のグローバルIPアドレス（例: 203.0.113.0/32）


原因2: UFW（Uncomplicated Firewall）がポート22を閉じていた
問題点
EC2インスタンス内のUFW（ローカルファイアウォール）でポート22が閉じられていた。
解決方法
以下のコマンドを実行してポート22を許可し、設定を反映しました。

    
    
        sudo ufw allow 22
sudo ufw reload
    
    Copy

    


原因3: グローバルIPの変動
問題点
自分のグローバルIPアドレスが変更されたことで、セキュリティグループのルールが機能しなくなった。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://america.github.io/posts/"},{"@type":"ListItem","position":2,"name":"AWSでSSH接続できない問題を解決した話","item":"https://america.github.io/posts/aws_ssh_issue/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"AWSでSSH接続できない問題を解決した話","name":"AWSでSSH接続できない問題を解決した話","description":"はじめに 先日、AWSで立てたEC2インスタンスにSSH接続できなくなる問題が発生しました。このトラブルの原因と解決方法を記録しておきます。同じ状況に陥った方の助けになれば幸いです。\n問題の症状 EC2インスタンスにSSH接続を試みると、Connection timed out のエラーが表示される。 AWSコンソール上では、インスタンスは正常に動作中。 ブラウザからの接続は可能（インスタンス内のApacheは稼働中）。 原因と解決方法 調査の結果、以下の4つの原因が考えられました。\n原因1: セキュリティグループのルール設定ミス 問題点\nセキュリティグループでポート22（SSH）が許可されていなかった。\n解決方法\nAWSコンソールのセキュリティグループ設定に以下のルールを追加：\nタイプ: SSH プロトコル: TCP ポート範囲: 22 ソース: 自分のグローバルIPアドレス（例: 203.0.113.0/32） 原因2: UFW（Uncomplicated Firewall）がポート22を閉じていた 問題点\nEC2インスタンス内のUFW（ローカルファイアウォール）でポート22が閉じられていた。\n解決方法\n以下のコマンドを実行してポート22を許可し、設定を反映しました。\nsudo ufw allow 22 sudo ufw reload Copy 原因3: グローバルIPの変動 問題点\n自分のグローバルIPアドレスが変更されたことで、セキュリティグループのルールが機能しなくなった。\n","keywords":["AWS","SSH","トラブルシューティング"],"articleBody":"はじめに 先日、AWSで立てたEC2インスタンスにSSH接続できなくなる問題が発生しました。このトラブルの原因と解決方法を記録しておきます。同じ状況に陥った方の助けになれば幸いです。\n問題の症状 EC2インスタンスにSSH接続を試みると、Connection timed out のエラーが表示される。 AWSコンソール上では、インスタンスは正常に動作中。 ブラウザからの接続は可能（インスタンス内のApacheは稼働中）。 原因と解決方法 調査の結果、以下の4つの原因が考えられました。\n原因1: セキュリティグループのルール設定ミス 問題点\nセキュリティグループでポート22（SSH）が許可されていなかった。\n解決方法\nAWSコンソールのセキュリティグループ設定に以下のルールを追加：\nタイプ: SSH プロトコル: TCP ポート範囲: 22 ソース: 自分のグローバルIPアドレス（例: 203.0.113.0/32） 原因2: UFW（Uncomplicated Firewall）がポート22を閉じていた 問題点\nEC2インスタンス内のUFW（ローカルファイアウォール）でポート22が閉じられていた。\n解決方法\n以下のコマンドを実行してポート22を許可し、設定を反映しました。\nsudo ufw allow 22 sudo ufw reload Copy 原因3: グローバルIPの変動 問題点\n自分のグローバルIPアドレスが変更されたことで、セキュリティグループのルールが機能しなくなった。\n解決方法\n新しいグローバルIPを確認し、セキュリティグループのSSHルールを更新しました。\ncurl ifconfig.me Copy 原因4: インターネットゲートウェイの設定ミス 問題点\nインターネットゲートウェイがVPCに正しくアタッチされていなかった。\n解決方法\nAWSコンソールのVPCダッシュボードで以下を確認しました：\nインターネットゲートウェイがVPCにアタッチされていること。 ルートテーブルに0.0.0.0/0のデフォルトルートがインターネットゲートウェイを指していること。 # 例: ルートテーブルの確認コマンド aws ec2 describe-route-tables --query \"RouteTables[*].Routes\" Copy 解決のポイント このケースでは、UFWの設定でポート22が閉じていた ことが主な原因でした。ローカルのファイアウォール設定とAWSのセキュリティグループ設定が一致していないことが問題を引き起こしていました。\n学んだこと 今回のトラブルから、以下の教訓を得ました：\n複数のセキュリティ設定を確認する\nAWSのセキュリティグループ設定だけでなく、サーバー内のファイアウォール設定（UFWやiptables）も忘れずに確認する。 接続トラブルの調査フローを明確にする\n以下の順番で確認するとスムーズに解決できます：\nセキュリティグループの設定確認。 ローカルファイアウォールの設定確認。 インターネットゲートウェイとルートテーブルの設定確認。 ローカルマシンのグローバルIPアドレス確認。 おわりに 「接続できない」という問題はシンプルに見えて、原因が複数絡んでいる場合があります。トラブルシューティングは焦らず、落ち着いて一つずつ原因を切り分けていくことが重要です。\n今回の記録が、同じ状況に陥った方の参考になれば幸いです。\n","wordCount":"83","inLanguage":"en","datePublished":"2024-11-20T00:00:00Z","dateModified":"2024-11-20T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://america.github.io/posts/aws_ssh_issue/"},"publisher":{"@type":"Organization","name":"雑記","logo":{"@type":"ImageObject","url":"https://america.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://america.github.io/ accesskey=h title="雑記 (Alt + H)">雑記</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">AWSでSSH接続できない問題を解決した話</h1><div class=post-meta><span title='2024-11-20 00:00:00 +0000 UTC'>November 20, 2024</span>&nbsp;·&nbsp;1 min</div></header><div class=post-content><h2 id=はじめに>はじめに<a hidden class=anchor aria-hidden=true href=#はじめに>#</a></h2><p>先日、AWSで立てたEC2インスタンスにSSH接続できなくなる問題が発生しました。このトラブルの原因と解決方法を記録しておきます。同じ状況に陥った方の助けになれば幸いです。</p><hr><h2 id=問題の症状>問題の症状<a hidden class=anchor aria-hidden=true href=#問題の症状>#</a></h2><ul><li>EC2インスタンスにSSH接続を試みると、<code>Connection timed out</code> のエラーが表示される。</li><li>AWSコンソール上では、インスタンスは正常に動作中。</li><li>ブラウザからの接続は可能（インスタンス内のApacheは稼働中）。</li></ul><hr><h2 id=原因と解決方法>原因と解決方法<a hidden class=anchor aria-hidden=true href=#原因と解決方法>#</a></h2><p>調査の結果、以下の4つの原因が考えられました。</p><h3 id=原因1-セキュリティグループのルール設定ミス><strong>原因1: セキュリティグループのルール設定ミス</strong><a hidden class=anchor aria-hidden=true href=#原因1-セキュリティグループのルール設定ミス>#</a></h3><p><strong>問題点</strong><br>セキュリティグループでポート22（SSH）が許可されていなかった。</p><p><strong>解決方法</strong><br>AWSコンソールのセキュリティグループ設定に以下のルールを追加：</p><ul><li>タイプ: SSH</li><li>プロトコル: TCP</li><li>ポート範囲: 22</li><li>ソース: 自分のグローバルIPアドレス（例: <code>203.0.113.0/32</code>）</li></ul><hr><h3 id=原因2-ufwuncomplicated-firewallがポート22を閉じていた><strong>原因2: UFW（Uncomplicated Firewall）がポート22を閉じていた</strong><a hidden class=anchor aria-hidden=true href=#原因2-ufwuncomplicated-firewallがポート22を閉じていた>#</a></h3><p><strong>問題点</strong><br>EC2インスタンス内のUFW（ローカルファイアウォール）でポート22が閉じられていた。</p><p><strong>解決方法</strong><br>以下のコマンドを実行してポート22を許可し、設定を反映しました。</p><div class=codeblock-wrapper><pre>
        <code id=codeblock-0 class=language-bash>sudo ufw allow 22
sudo ufw reload</code>
    </pre><button class=copy-btn onclick='copyToClipboard("codeblock-0")'>Copy</button>
<script>function copyToClipboard(e){const t=document.getElementById(e);if(!t)return;const n=t.textContent.replace(/^\$\s/gm,"");navigator.clipboard.writeText(n).then(()=>{alert("Copied!")}).catch(e=>{console.error("Failed to copy: ",e)})}</script></div><hr><h3 id=原因3-グローバルipの変動><strong>原因3: グローバルIPの変動</strong><a hidden class=anchor aria-hidden=true href=#原因3-グローバルipの変動>#</a></h3><p><strong>問題点</strong><br>自分のグローバルIPアドレスが変更されたことで、セキュリティグループのルールが機能しなくなった。</p><p><strong>解決方法</strong><br>新しいグローバルIPを確認し、セキュリティグループのSSHルールを更新しました。</p><div class=codeblock-wrapper><pre>
        <code id=codeblock-1 class=language-bash>curl ifconfig.me</code>
    </pre><button class=copy-btn onclick='copyToClipboard("codeblock-1")'>Copy</button>
<script>function copyToClipboard(e){const t=document.getElementById(e);if(!t)return;const n=t.textContent.replace(/^\$\s/gm,"");navigator.clipboard.writeText(n).then(()=>{alert("Copied!")}).catch(e=>{console.error("Failed to copy: ",e)})}</script></div><hr><h3 id=原因4-インターネットゲートウェイの設定ミス><strong>原因4: インターネットゲートウェイの設定ミス</strong><a hidden class=anchor aria-hidden=true href=#原因4-インターネットゲートウェイの設定ミス>#</a></h3><p><strong>問題点</strong><br>インターネットゲートウェイがVPCに正しくアタッチされていなかった。</p><p><strong>解決方法</strong><br>AWSコンソールのVPCダッシュボードで以下を確認しました：</p><ol><li>インターネットゲートウェイがVPCにアタッチされていること。</li><li>ルートテーブルに<code>0.0.0.0/0</code>のデフォルトルートがインターネットゲートウェイを指していること。</li></ol><div class=codeblock-wrapper><pre>
        <code id=codeblock-2 class=language-bash># 例: ルートテーブルの確認コマンド
aws ec2 describe-route-tables --query "RouteTables[*].Routes"</code>
    </pre><button class=copy-btn onclick='copyToClipboard("codeblock-2")'>Copy</button>
<script>function copyToClipboard(e){const t=document.getElementById(e);if(!t)return;const n=t.textContent.replace(/^\$\s/gm,"");navigator.clipboard.writeText(n).then(()=>{alert("Copied!")}).catch(e=>{console.error("Failed to copy: ",e)})}</script></div><hr><h2 id=解決のポイント>解決のポイント<a hidden class=anchor aria-hidden=true href=#解決のポイント>#</a></h2><p>このケースでは、<strong>UFWの設定でポート22が閉じていた</strong> ことが主な原因でした。ローカルのファイアウォール設定とAWSのセキュリティグループ設定が一致していないことが問題を引き起こしていました。</p><hr><h2 id=学んだこと>学んだこと<a hidden class=anchor aria-hidden=true href=#学んだこと>#</a></h2><p>今回のトラブルから、以下の教訓を得ました：</p><ol><li><p><strong>複数のセキュリティ設定を確認する</strong></p><ul><li>AWSのセキュリティグループ設定だけでなく、サーバー内のファイアウォール設定（UFWやiptables）も忘れずに確認する。</li></ul></li><li><p><strong>接続トラブルの調査フローを明確にする</strong><br>以下の順番で確認するとスムーズに解決できます：</p><ol><li>セキュリティグループの設定確認。</li><li>ローカルファイアウォールの設定確認。</li><li>インターネットゲートウェイとルートテーブルの設定確認。</li><li>ローカルマシンのグローバルIPアドレス確認。</li></ol></li></ol><hr><h2 id=おわりに>おわりに<a hidden class=anchor aria-hidden=true href=#おわりに>#</a></h2><p>「接続できない」という問題はシンプルに見えて、原因が複数絡んでいる場合があります。トラブルシューティングは焦らず、落ち着いて一つずつ原因を切り分けていくことが重要です。</p><p>今回の記録が、同じ状況に陥った方の参考になれば幸いです。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://america.github.io/tags/aws/>AWS</a></li><li><a href=https://america.github.io/tags/ssh/>SSH</a></li><li><a href=https://america.github.io/tags/%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/>トラブルシューティング</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://america.github.io/>雑記</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script src=https://america.github.io/js/copy.min.ca422681c4e4c17e79d032a2f8d68bccfa17c41ad25b1af176988aa4e64a01a9.js></script></body></html>